name: Cygwin trunk

on:
  workflow_run:
    workflows: [Cygwin trunk part one]
    types: [completed]

jobs:
  build:
    uses: ./.github/workflows/common.yml
    with:
      runs_on: windows-latest
      compiler: ocaml.5.1.0
      cygwin: waiter
      compiler_git_ref: refs/heads/trunk
      timeout: 360
      subsuite: src/lazy src/neg_tests src/queue src/semaphore src/stack src/statistics src/sys src/thread src/threadomain src/weak

  reporter:
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'failure' }}
    steps:
      - run: |
          echo 'Failure in the first part of the test suite, see corresponding log'
          exit 1
